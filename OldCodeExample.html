<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Guesser Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple transition for showing/hiding screens */
        .screen {
            display: none;
            animation: fadeIn 0.5s;
        }
        .screen.active {
            display: flex; /* Using flex for centering content */
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-md mx-auto">
        <!-- ===== SETUP SCREEN ===== -->
        <div id="setup-screen" class="screen active flex-col items-center justify-center">
            <div class="bg-white p-8 rounded-2xl shadow-lg w-full text-center">
                <h1 class="text-4xl font-bold mb-2 text-slate-900">Word Guesser</h1>
                <p class="text-slate-500 mb-8">A team-based word description game.</p>
                
                <div class="mb-8">
                    <h2 class="text-xl font-semibold mb-4 text-slate-700">Enter Team Names</h2>
                    <div class="flex gap-2 mb-4">
                        <input type="text" id="team-name-input" placeholder="e.g., The Winners" class="flex-grow p-3 border-2 border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-300 focus:border-indigo-400 outline-none">
                        <button id="add-team-btn" class="bg-slate-700 text-white font-bold py-3 px-5 rounded-lg hover:bg-slate-800 transition-transform hover:scale-105">Add</button>
                    </div>
                    <div id="team-names-list" class="space-y-2">
                        <!-- Added teams will appear here -->
                    </div>
                </div>

                <button id="start-game-btn" class="bg-indigo-600 text-white font-bold py-4 px-6 rounded-lg w-full hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-300 transition-transform hover:scale-105 disabled:bg-slate-400 disabled:cursor-not-allowed disabled:scale-100" disabled>
                    Start Game
                </button>
            </div>
        </div>

        <!-- ===== TRANSITION SCREEN ===== -->
        <div id="transition-screen" class="screen flex-col items-center justify-center">
            <div class="bg-white p-8 rounded-2xl shadow-lg w-full text-center">
                 <h2 id="transition-team-name" class="text-3xl font-bold mb-4 text-slate-900">Get Ready, Team 1!</h2>
                 <p class="text-slate-500 mb-6">Your turn is next. Choose a player to describe the words.</p>
                 <p class="text-slate-500 mb-8 text-sm">Pass the device to the guessers when the describer is ready.</p>
                 <button id="start-turn-btn" class="bg-emerald-600 text-white font-bold py-4 px-6 rounded-lg w-full hover:bg-emerald-700 focus:outline-none focus:ring-4 focus:ring-emerald-300 transition-transform hover:scale-105">
                    I'm Ready!
                 </button>
            </div>
        </div>

        <!-- ===== GAME SCREEN ===== -->
        <div id="game-screen" class="screen flex-col items-center justify-center">
            <div class="bg-white p-6 rounded-2xl shadow-lg w-full text-center flex flex-col h-[80vh] max-h-[600px]">
                <!-- Header: Timer and Team Info -->
                <div class="flex justify-between items-center border-b pb-4 mb-4">
                    <div class="text-left">
                        <p id="game-team-name" class="font-bold text-xl text-slate-800">Team 1</p>
                        <p id="game-round-display" class="text-sm text-slate-500">Round 1 of 3</p>
                    </div>
                    <div id="timer-display" class="text-5xl font-bold text-indigo-600">30</div>
                </div>

                <!-- Main Word Display -->
                <div class="flex-grow flex flex-col items-center justify-center bg-slate-50 rounded-lg p-4">
                    <h2 id="word-display" class="font-bold text-slate-900 mb-2 break-all">WORD</h2>
                    <p id="category-display" class="text-lg text-slate-500 font-medium">CATEGORY</p>
                    <!-- AI Hint Feature -->
                    <div id="hint-container" class="mt-4 text-center">
                        <button id="get-hint-btn" class="bg-sky-500 text-white font-semibold py-2 px-4 rounded-lg text-sm hover:bg-sky-600 transition disabled:bg-slate-400 disabled:cursor-wait">Get Hint</button>
                        <p id="hint-display" class="text-slate-600 mt-2 text-sm h-10"></p>
                    </div>
                </div>

                <!-- Score and Skips -->
                 <div class="flex justify-between items-center mt-4 text-slate-600">
                    <p>Skips Remaining: <span id="skips-remaining" class="font-bold">1</span></p>
                    <p>Turn Score: <span id="turn-score" class="font-bold">0</span></p>
                </div>

                <!-- Action Buttons -->
                <div class="grid grid-cols-2 gap-4 mt-6">
                    <button id="skip-btn" class="bg-amber-500 text-white font-bold py-4 rounded-lg text-lg transition-transform hover:scale-105">Skip</button>
                    <button id="correct-btn" class="bg-emerald-600 text-white font-bold py-4 rounded-lg text-lg transition-transform hover:scale-105">Correct</button>
                </div>
            </div>
        </div>

        <!-- ===== TURN SUMMARY SCREEN ===== -->
        <div id="turn-summary-screen" class="screen flex-col items-center justify-center">
            <div class="bg-white p-8 rounded-2xl shadow-lg w-full">
                <h2 class="text-3xl font-bold mb-2 text-center text-slate-900">Time's Up!</h2>
                <p id="turn-summary-team-name" class="text-lg text-slate-500 mb-6 text-center">Team 1 scored 5 points this turn.</p>
                
                <div class="mb-6">
                    <h3 class="font-bold text-slate-700 mb-2">Words this turn:</h3>
                    <div id="turn-summary-words-list" class="max-h-24 overflow-y-auto bg-slate-50 p-3 rounded-lg text-sm space-y-1">
                        <!-- Words will be dynamically inserted here -->
                    </div>
                </div>

                <div class="mb-6">
                    <h3 class="font-bold text-slate-700 mb-2">Leaderboard</h3>
                    <div id="leaderboard-list" class="space-y-2">
                        <!-- Leaderboard will be dynamically inserted here -->
                    </div>
                </div>

                <button id="next-turn-btn" class="bg-indigo-600 text-white font-bold py-4 px-6 rounded-lg w-full hover:bg-indigo-700 transition-transform hover:scale-105">
                    Next Turn
                </button>
            </div>
        </div>
        
        <!-- ===== GAME OVER SCREEN ===== -->
        <div id="game-over-screen" class="screen flex-col items-center justify-center">
            <div class="bg-white p-8 rounded-2xl shadow-lg w-full text-center">
                <h1 id="game-over-title" class="text-4xl font-bold mb-4 text-slate-900">Game Over!</h1>
                <p class="text-slate-500 mb-6">Final Scores:</p>
                <div id="final-leaderboard-list" class="space-y-2 mb-8">
                    <!-- Final leaderboard inserted here -->
                </div>
                <button id="play-again-btn" class="bg-emerald-600 text-white font-bold py-4 px-6 rounded-lg w-full hover:bg-emerald-700 transition-transform hover:scale-105">
                    Play Again
                </button>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CONFIG & SETTINGS ---
            const GAME_SETTINGS = {
                TURN_DURATION: 30, // Official time
                TOTAL_ROUNDS: 3,
                SKIPS_PER_TURN: 1,
                PENALTY_FOR_EXTRA_SKIP: 1,
                ALLOWED_DIFFICULTIES: ['easy', 'medium'],
            };
            
            // --- AUDIO ---
            let sounds = {};
            let audioInitialized = false;

            // --- WORD DATA (will be fetched from URL) ---
            let wordsByCategory = {};

            // --- GAME STATE ---
            let gameState = {
                teams: [],
                currentTeamIndex: 0,
                currentRound: 1,
                // Turn-specific state
                turnScore: 0,
                skipsRemaining: 0,
                timeLeft: 0,
                timer: null,
                wordsByCategoryForGame: {},
                turnWords: [],
                currentWord: null,
                currentTurnCategory: null,
            };

            // --- DOM ELEMENTS ---
            const screens = document.querySelectorAll('.screen');
            const startGameBtn = document.getElementById('start-game-btn');
            const transitionTeamNameEl = document.getElementById('transition-team-name');
            const startTurnBtn = document.getElementById('start-turn-btn');
            const teamNameInput = document.getElementById('team-name-input');
            const addTeamBtn = document.getElementById('add-team-btn');
            const teamNamesList = document.getElementById('team-names-list');

            // Game Screen Elements
            const gameTeamNameEl = document.getElementById('game-team-name');
            const gameRoundDisplayEl = document.getElementById('game-round-display');
            const timerDisplayEl = document.getElementById('timer-display');
            const wordDisplayEl = document.getElementById('word-display');
            const categoryDisplayEl = document.getElementById('category-display');
            const skipsRemainingEl = document.getElementById('skips-remaining');
            const turnScoreEl = document.getElementById('turn-score');
            const skipBtn = document.getElementById('skip-btn');
            const correctBtn = document.getElementById('correct-btn');
            const getHintBtn = document.getElementById('get-hint-btn');
            const hintDisplayEl = document.getElementById('hint-display');


            // Turn Summary Elements
            const turnSummaryTeamNameEl = document.getElementById('turn-summary-team-name');
            const turnSummaryWordsListEl = document.getElementById('turn-summary-words-list');
            const leaderboardListEl = document.getElementById('leaderboard-list');
            const nextTurnBtn = document.getElementById('next-turn-btn');

            // Game Over Elements
            const gameOverTitleEl = document.getElementById('game-over-title');
            const finalLeaderboardListEl = document.getElementById('final-leaderboard-list');
            const playAgainBtn = document.getElementById('play-again-btn');


            /**
             * Hides all screens and shows the one with the specified ID
             * @param {string} screenId 
             */
            function showScreen(screenId) {
                screens.forEach(screen => {
                    screen.classList.remove('active');
                });
                const activeScreen = document.getElementById(screenId);
                if (activeScreen) {
                    activeScreen.classList.add('active');
                }
            }

            /**
             * Sets up the different sound synthesizers
             */
            function setupSounds() {
                sounds.correct = new Tone.Synth({ oscillator: { type: 'sine' }, envelope: { attack: 0.005, decay: 0.1, sustain: 0.3, release: 0.1 } }).toDestination();
                sounds.skip = new Tone.Synth({ oscillator: { type: 'triangle' }, envelope: { attack: 0.005, decay: 0.1, sustain: 0.3, release: 0.1 } }).toDestination();
                sounds.timesUp = new Tone.Synth({ oscillator: { type: 'sawtooth' }, envelope: { attack: 0.01, decay: 0.2, sustain: 0.2, release: 0.2 } }).toDestination();
            }

            /**
             * Plays a specific sound if audio is initialized
             * @param {('correct'|'skip'|'timesUp')} sound 
             */
            function playSound(sound) {
                if (!audioInitialized || !sounds[sound]) return;
                
                if (sound === 'correct') {
                    sounds.correct.triggerAttackRelease('C5', '8n');
                } else if (sound === 'skip') {
                    sounds.skip.triggerAttackRelease('A4', '8n');
                } else if (sound === 'timesUp') {
                    sounds.timesUp.triggerAttackRelease('G4', '4n');
                }
            }

            /**
             * Fetches and parses the CSV string into a usable object of word arrays, grouped by category
             */
            async function parseWords() {
                const csvUrl = 'https://gist.githubusercontent.com/jdcb4/d71d7c40e28902e4e552335fc79bdf1f/raw/bb008b6252475f71daf79fbf3cfdebe4bfa1504d/words.csv';
                try {
                    const response = await fetch(csvUrl);
                    if (!response.ok) {
                        throw new Error(`Network response was not ok: ${response.statusText}`);
                    }
                    const wordDataCSV = await response.text();

                    const rows = wordDataCSV.trim().split('\n').slice(1); // remove header
                    const allWords = rows.map(row => {
                        const [word, category, difficulty] = row.split(',');
                        if (word && category && difficulty) {
                             // --- FIX: Make case-insensitive ---
                             return { 
                                word: word.trim().toUpperCase(), 
                                category: category.trim().toLowerCase(), 
                                difficulty: difficulty.trim().toLowerCase() 
                            };
                        }
                        return null;
                    }).filter(Boolean); // This removes any null entries from bad rows
                    
                    const filteredWords = allWords.filter(wordObj => 
                        wordObj.word && GAME_SETTINGS.ALLOWED_DIFFICULTIES.includes(wordObj.difficulty)
                    );

                    // Group words by category
                    wordsByCategory = {};
                    filteredWords.forEach(word => {
                        if (!wordsByCategory[word.category]) {
                            wordsByCategory[word.category] = [];
                        }
                        wordsByCategory[word.category].push(word);
                    });

                } catch (error) {
                    console.error("Could not load word list:", error);
                    const setupDiv = document.getElementById('setup-screen').querySelector('.bg-white');
                    const errorEl = document.createElement('p');
                    errorEl.textContent = 'Error: Could not load the word list. Please check the URL and your internet connection.';
                    errorEl.className = 'text-red-500 font-bold mt-4';
                    setupDiv.appendChild(errorEl);
                    startGameBtn.disabled = true;
                }
            }

           function renderTeamList() {
               teamNamesList.innerHTML = '';
               gameState.teams.forEach((team, index) => {
                   const teamEl = document.createElement('div');
                   teamEl.className = 'flex justify-between items-center bg-slate-100 p-3 rounded-lg';
                   teamEl.innerHTML = `<span class="font-semibold text-slate-700">${team.name}</span><button data-index="${index}" class="remove-team-btn text-red-500 hover:text-red-700 font-bold">âœ•</button>`;
                   teamNamesList.appendChild(teamEl);
               });
           }

           function handleAddTeam() {
               const name = teamNameInput.value.trim();
               if (name) {
                   gameState.teams.push({ name: name, score: 0 });
                   teamNameInput.value = '';
                   renderTeamList();
                   startGameBtn.disabled = gameState.teams.length < 2;
               }
               teamNameInput.focus();
           }

           function handleRemoveTeam(e) {
               if (e.target.classList.contains('remove-team-btn')) {
                   const indexToRemove = parseInt(e.target.dataset.index, 10);
                   gameState.teams.splice(indexToRemove, 1);
                   renderTeamList();
                   startGameBtn.disabled = gameState.teams.length < 2;
               }
           }

            /**
             * Shuffles an array in place
             * @param {Array} array 
             */
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            /**
             * Initializes the game state based on setup choices and starts the game
             */
            function initializeGame() {
                 // Initialize audio context on first user gesture
                 if (!audioInitialized) {
                    Tone.start().then(() => {
                        setupSounds();
                        audioInitialized = true;
                        console.log("Audio context started.");
                    });
                }
                gameState.currentTeamIndex = 0;
                gameState.currentRound = 1;
 
                // Deep copy and shuffle words for the game
                gameState.wordsByCategoryForGame = JSON.parse(JSON.stringify(wordsByCategory));
                for (const category in gameState.wordsByCategoryForGame) {
                    shuffleArray(gameState.wordsByCategoryForGame[category]);
                }

                // Move to the first transition screen
                prepareTransitionScreen();
            }

            /**
             * Sets up the transition screen for the current team
             */
            function prepareTransitionScreen() {
                 const currentTeam = gameState.teams[gameState.currentTeamIndex];
                 const message = `Get Ready, ${currentTeam.name}!`;
                 transitionTeamNameEl.textContent = message;
                 showScreen('transition-screen');
            }

            /**
             * Starts a new turn for the current team
             */
            function startTurn() {
                // Reset turn state
                gameState.timeLeft = GAME_SETTINGS.TURN_DURATION;
                gameState.turnScore = 0;
                gameState.skipsRemaining = GAME_SETTINGS.SKIPS_PER_TURN;
                gameState.turnWords = [];
                hintDisplayEl.textContent = ''; // Clear previous hint

                // --- NEW: Select a category for the turn ---
                const availableCategories = Object.keys(gameState.wordsByCategoryForGame).filter(
                    cat => gameState.wordsByCategoryForGame[cat].length > 0
                );

                if (availableCategories.length === 0) {
                    endGame(); 
                    return;
                }
                gameState.currentTurnCategory = availableCategories[Math.floor(Math.random() * availableCategories.length)];
                
                // Update UI
                const currentTeam = gameState.teams[gameState.currentTeamIndex];
                gameTeamNameEl.textContent = currentTeam.name;

                // --- FIX: Re-enable buttons at the start of a turn ---
                skipBtn.disabled = false;
                correctBtn.disabled = false;
                
                gameRoundDisplayEl.textContent = `Round ${gameState.currentRound} of ${GAME_SETTINGS.TOTAL_ROUNDS}`;
                timerDisplayEl.textContent = gameState.timeLeft;
                turnScoreEl.textContent = gameState.turnScore;
                skipsRemainingEl.textContent = gameState.skipsRemaining;
                
                nextWord();
                showScreen('game-screen');
                
                // Start timer
                gameState.timer = setInterval(() => {
                    gameState.timeLeft--;
                    timerDisplayEl.textContent = gameState.timeLeft;
                    if (gameState.timeLeft <= 0) {
                        endTurn();
                    }
                }, 1000);
            }

             /**
             * Dynamically adjusts the font size of the word display based on word length.
             * @param {string} wordText The word to display.
             */
            function resizeWordText(wordText) {
                wordDisplayEl.classList.remove('text-6xl', 'text-5xl', 'text-4xl', 'md:text-6xl');
                if (wordText.length > 20) {
                    wordDisplayEl.classList.add('text-4xl');
                } else if (wordText.length > 12) {
                    wordDisplayEl.classList.add('text-5xl');
                } else {
                    wordDisplayEl.classList.add('text-6xl', 'md:text-6xl');
                }
            }
            
            /**
             * Fetches and displays the next word from the shuffled list for the current turn's category
             */
            function nextWord() {
                hintDisplayEl.textContent = ''; // Clear previous hint
                getHintBtn.disabled = false; // Re-enable hint button

                let wordsInTurnCategory = gameState.wordsByCategoryForGame[gameState.currentTurnCategory];

                if (!wordsInTurnCategory || wordsInTurnCategory.length === 0) {
                    // --- CHANGE: Re-shuffle and replenish the category if it's empty ---
                    console.log(`Reshuffling category: ${gameState.currentTurnCategory}`);
                    const originalCategoryWords = wordsByCategory[gameState.currentTurnCategory];
                    if (!originalCategoryWords || originalCategoryWords.length === 0) {
                        // This category is permanently empty, which shouldn't happen if parsing is correct.
                        endGame(); // End game if something is critically wrong.
                        return;
                    }
                    const newShuffledList = [...originalCategoryWords];
                    shuffleArray(newShuffledList);
                    gameState.wordsByCategoryForGame[gameState.currentTurnCategory] = newShuffledList;
                    
                    wordsInTurnCategory = newShuffledList;
                }
                
                gameState.currentWord = wordsInTurnCategory.pop();
                resizeWordText(gameState.currentWord.word);
                wordDisplayEl.textContent = gameState.currentWord.word;
                categoryDisplayEl.textContent = gameState.currentWord.category.charAt(0).toUpperCase() + gameState.currentWord.category.slice(1);
            }

            function handleCorrect() {
                playSound('correct');
                gameState.turnScore++;
                gameState.turnWords.push({ ...gameState.currentWord, status: 'correct' });
                turnScoreEl.textContent = gameState.turnScore;
                nextWord();
            }

            function handleSkip() {
                playSound('skip');
                if (gameState.skipsRemaining > 0) {
                    gameState.skipsRemaining--;
                } else {
                    gameState.turnScore = Math.max(0, gameState.turnScore - GAME_SETTINGS.PENALTY_FOR_EXTRA_SKIP);
                }
                gameState.turnWords.push({ ...gameState.currentWord, status: 'skipped' });
                skipsRemainingEl.textContent = gameState.skipsRemaining;
                turnScoreEl.textContent = gameState.turnScore;
                nextWord();
            }
            
             /**
             * Calls the Gemini API to get a hint for the current word.
             */
            async function getAIHint() {
                if (!gameState.currentWord) return;

                const API_KEY = "YOUR_GEMINI_API_KEY_HERE"; // <-- IMPORTANT: PASTE YOUR KEY HERE
                if (API_KEY === "YOUR_GEMINI_API_KEY_HERE") {
                    hintDisplayEl.textContent = "API Key not configured in the code.";
                    return;
                }

                getHintBtn.disabled = true;
                hintDisplayEl.textContent = "Thinking...";

                const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;
                const prompt = `Give me a short, one-sentence hint for a word-guessing game. The word is "${gameState.currentWord.word}". Do not use the word itself or parts of the word in the hint.`;

                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });

                    if (!response.ok) {
                        throw new Error(`API Error: ${response.statusText}`);
                    }

                    const data = await response.json();
                    const hint = data.candidates[0].content.parts[0].text;
                    hintDisplayEl.textContent = hint.trim();

                } catch (error) {
                    console.error("Error fetching hint:", error);
                    hintDisplayEl.textContent = "Could not get a hint at this time.";
                    getHintBtn.disabled = false; // Re-enable on error
                }
            }

            /**
             * Ends the current turn, updates scores, and moves to the summary screen.
             */
            function endTurn() {
                clearInterval(gameState.timer);
                playSound('timesUp');
                
                const currentTeam = gameState.teams[gameState.currentTeamIndex];
                currentTeam.score += gameState.turnScore;

                populateTurnSummary();
                showScreen('turn-summary-screen');
            }

            function populateTurnSummary() {
                const currentTeam = gameState.teams[gameState.currentTeamIndex];
                turnSummaryTeamNameEl.textContent = `${currentTeam.name} scored ${gameState.turnScore} point(s) this turn.`;

                // Populate words list
                turnSummaryWordsListEl.innerHTML = '';
                if (gameState.turnWords.length === 0) {
                    turnSummaryWordsListEl.innerHTML = '<p class="text-slate-500">No words were answered.</p>';
                } else {
                    gameState.turnWords.forEach(word => {
                        const statusClass = word.status === 'correct' ? 'text-emerald-600' : 'text-amber-600';
                        const statusText = word.status === 'correct' ? 'Correct' : 'Skipped';
                        const el = document.createElement('div');
                        el.className = 'flex justify-between';
                        el.innerHTML = `<span>${word.word}</span><span class="font-bold ${statusClass}">${statusText}</span>`;
                        turnSummaryWordsListEl.appendChild(el);
                    });
                }
                
                // Populate leaderboard
                leaderboardListEl.innerHTML = '';
                const sortedTeams = [...gameState.teams].sort((a, b) => b.score - a.score);
                sortedTeams.forEach(team => {
                    const el = document.createElement('div');
                    el.className = 'flex justify-between bg-slate-100 p-2 rounded-md';
                    el.innerHTML = `<span class="font-semibold">${team.name}</span><span>${team.score} point(s)</span>`;
                    leaderboardListEl.appendChild(el);
                });
            }

            function advanceToNextTurn() {
                gameState.currentTeamIndex = (gameState.currentTeamIndex + 1) % gameState.teams.length;

                // Check if a full round has passed
                if (gameState.currentTeamIndex === 0) {
                    gameState.currentRound++;
                }

                // Check if the game is over
                if (gameState.currentRound > GAME_SETTINGS.TOTAL_ROUNDS) {
                    endGame();
                } else {
                    prepareTransitionScreen();
                }
            }

            function endGame() {
                const sortedTeams = [...gameState.teams].sort((a, b) => b.score - a.score);
                const winner = sortedTeams[0];
                
                // Check for a tie
                const isTie = sortedTeams.length > 1 && sortedTeams[0].score === sortedTeams[1].score;
                if (isTie) {
                    gameOverTitleEl.textContent = "It's a Tie!";
                } else {
                    gameOverTitleEl.textContent = `${winner.name} Wins!`;
                }

                // Populate final leaderboard
                finalLeaderboardListEl.innerHTML = '';
                 sortedTeams.forEach(team => {
                    const el = document.createElement('div');
                    el.className = 'flex justify-between bg-slate-100 p-2 rounded-md text-lg';
                    el.innerHTML = `<span class="font-semibold">${team.name}</span><span>${team.score} point(s)</span>`;
                    finalLeaderboardListEl.appendChild(el);
                });

                showScreen('game-over-screen');
            }



            // --- EVENT LISTENERS ---
            addTeamBtn.addEventListener('click', handleAddTeam);
            teamNameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleAddTeam();
                }
            });
            teamNamesList.addEventListener('click', handleRemoveTeam);
            startGameBtn.addEventListener('click', initializeGame);
            startTurnBtn.addEventListener('click', startTurn);
            correctBtn.addEventListener('click', handleCorrect);
            skipBtn.addEventListener('click', handleSkip);
            getHintBtn.addEventListener('click', getAIHint);
            nextTurnBtn.addEventListener('click', advanceToNextTurn);
            playAgainBtn.addEventListener('click', () => {
                location.reload(); 
            });


            // --- INITIALIZATION ---
            async function init() {
                await parseWords();
                showScreen('setup-screen');
            }

            init();
        });
    </script>
</body>
</html>

